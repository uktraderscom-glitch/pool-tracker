<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pool League Tracker — Spot On Sheriff</title>
  <style>
    body { font-family: Arial, sans‑serif; margin:0; padding:0; }
    header { background:#333; color:white; padding:10px; }
    nav { display:flex; background:#444; }
    nav button { flex:1; padding:10px; border:none; background:#444; color:white; cursor:pointer; }
    nav button.active { background:#666; }
    section { display:none; padding:20px; }
    section.active { display:block; }
    input[type=text], input[type=number], select { padding:5px; margin:5px 0; width:200px; }
    .btn { padding:6px 12px; margin:5px; cursor:pointer; }
    .btn-primary { background:#28a745; color:white; border:none; }
    .btn-danger { background:#dc3545; color:white; border:none; }
    .btn-edit { background:#007bff; color:white; border:none; }
    table { width:100%; border-collapse:collapse; margin-top:10px; }
    table, th, td { border:1px solid #888; }
    th, td { padding:8px; text-align:left; }
    .modal { display:none; position:fixed; z-index:999; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.5); align-items:center; justify-content:center; }
    .modal-content { background:white; padding:20px; border-radius:4px; width:320px; }
  </style>
</head>
<body>

<header><h1>Pool League Tracker — Spot On Sheriff</h1></header>

<nav>
  <button id="tabSeasons" class="active">Seasons</button>
  <button id="tabPlayers">Players</button>
  <button id="tabTeams">Teams</button>
  <button id="tabMatches">Record Match</button>
  <button id="tabStats">Stats</button>
</nav>

<section id="sectionSeasons" class="active">
  <h2>Seasons</h2>
  <form id="formSeason">
    <label>Year:<br/><input type="number" id="seasonYear" min="2000" required /></label><br/>
    <label>Type:<br/>
      <select id="seasonType" required>
        <option value="">Select</option>
        <option value="SUMMER">SUMMER</option>
        <option value="WINTER">WINTER</option>
      </select>
    </label><br/>
    <label>Division:<br/>
      <select id="seasonDivision" required>
        <option value="">Select Division</option>
        <option value="Monday BB Premier 1">Monday BB Premier 1</option>
        <option value="Monday BB Premier 2">Monday BB Premier 2</option>
        <option value="Monday BB Premier 3">Monday BB Premier 3</option>
        <option value="Monday EPA League 1">Monday EPA League 1</option>
        <option value="Monday EPA League 2">Monday EPA League 2</option>
        <option value="Monday EPA League 3">Monday EPA League 3</option>
        <option value="Monday EPA League 4">Monday EPA League 4</option>
      </select>
    </label><br/>
    <label>Frames per Match:<br/><input type="number" id="seasonFrames" min="1" required /></label><br/>
    <button class="btn btn-primary" type="submit">Add Season</button>
  </form>
  <h3>Existing Seasons</h3>
  <table id="tableSeasons">
    <thead><tr><th>Season</th><th>Frames</th><th>Actions</th></tr></thead>
    <tbody></tbody>
  </table>
</section>

<section id="sectionPlayers">
  <h2>Players</h2>
  <form id="formPlayer">
    <label>Season:<br/>
      <select id="playerSeason" required>
        <option value="">Select Season</option>
      </select>
    </label><br/>
    <label>Team:<br/>
      <select id="playerTeam" required>
        <option value="">Select Season First</option>
      </select>
    </label><br/>
    <label>Full Name:<br/>
      <input type="text" id="playerName" required />
    </label><br/>
    <label>Standard:<br/>
      <select id="playerStandard" required>
        <option value="">Select</option>
        <option value="A+">A+</option>
        <option value="A">A</option>
        <option value="A-">A-</option>
        <option value="B+">B+</option>
        <option value="B">B</option>
        <option value="B-">B-</option>
        <option value="C+">C+</option>
        <option value="C">C</option>
        <option value="C-">C-</option>
      </select>
    </label><br/>
    <button class="btn btn-primary" type="submit">Add Player</button>
  </form>

  <h3>All Players</h3>
  <table id="tablePlayers">
    <thead><tr><th>Name</th><th>Team</th><th>Standard</th><th>Season</th><th>Actions</th></tr></thead>
    <tbody></tbody>
  </table>
</section>

<section id="sectionTeams">
  <h2>Teams</h2>
  <form id="formTeam">
    <label>Season:<br/><select id="teamSeason" required></select></label><br/>
    <label>Team Name:<br/><input type="text" id="teamName" required /></label><br/>
    <label>Division:<br/>
      <select id="teamDivision" required>
        <option value="">Select Division</option>
        <option value="Monday BB Premier 1">Monday BB Premier 1</option>
        <option value="Monday BB Premier 2">Monday BB Premier 2</option>
        <option value="Monday BB Premier 3">Monday BB Premier 3</option>
        <option value="Monday EPA League 1">Monday EPA League 1</option>
        <option value="Monday EPA League 2">Monday EPA League 2</option>
        <option value="Monday EPA League 3">Monday EPA League 3</option>
        <option value="Monday EPA League 4">Monday EPA League 4</option>
      </select>
    </label><br/>
    <label>Venue Address:<br/><input type="text" id="teamVenue" required /></label><br/>
    <button class="btn btn-primary" type="submit">Add Team</button>
  </form>

  <h3>All Teams</h3>
  <table id="tableTeams">
    <thead><tr><th>Season</th><th>Name</th><th>Division</th><th>Venue</th><th>Actions</th></tr></thead>
    <tbody></tbody>
  </table>
</section>

<section id="sectionMatches">
  <h2>Record Match</h2>
  <p>Coming soon.</p>
</section>

<section id="sectionStats">
  <h2>Stats</h2>
  <p>Coming soon.</p>
</section>

<div id="editPlayerModal" class="modal">
  <div class="modal-content">
    <h3>Edit Player (Adds new entry)</h3>
    <label>Team:<br/><input type="text" id="editPlayerTeam" required /></label><br/>
    <label>Standard:<br/>
      <select id="editPlayerStandard" required>
        <option value="">Select</option>
        <option value="A+">A+</option>
        <option value="A">A</option>
        <option value="A‑">A‑</option>
        <option value="B+">B+</option>
        <option value="B">B</option>
        <option value="B‑">B‑</option>
        <option value="C+">C+</option>
        <option value="C">C</option>
        <option value="C‑">C‑</option>
      </select>
    </label><br/>
    <label>Season:<br/><select id="editPlayerSeason" required></select></label><br/>
    <button id="btnSavePlayerEdit" class="btn btn-primary">Save</button>
    <button id="btnCancelPlayerEdit" class="btn btn-danger">Cancel</button>
  </div>
</div>

<div id="editTeamModal" class="modal">
  <div class="modal-content">
    <h3>Edit Team (Adds new entry)</h3>
    <label>Team Name:<br/><input type="text" id="editTeamName" required /></label><br/>
    <label>Division:<br/>
      <select id="editTeamDivision" required>
        <option value="">Select Division</option>
        <option value="Monday BB Premier 1">Monday BB Premier 1</option>
        <option value="Monday BB Premier 2">Monday BB Premier 2</option>
        <option value="Monday BB Premier 3">Monday BB Premier 3</option>
        <option value="Monday EPA League 1">Monday EPA League 1</option>
        <option value="Monday EPA League 2">Monday EPA League 2</option>
        <option value="Monday EPA League 3">Monday EPA League 3</option>
        <option value="Monday EPA League 4">Monday EPA League 4</option>
      </select>
    </label><br/>
    <label>Venue Address:<br/><input type="text" id="editTeamVenue" required /></label><br/>
    <label>Season:<br/><select id="editTeamSeason" required></select></label><br/>
    <button id="btnSaveTeamEdit" class="btn btn-primary">Save</button>
    <button id="btnCancelTeamEdit" class="btn btn-danger">Cancel</button>
  </div>
</div>

<!-- Firebase scripts -->
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js"></script>

<script>
  // Replace with your actual Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDfFzaHPd88vVCoJgB0KW85QULVkGKX1UQ",
    authDomain: "pool-tracker25.firebaseapp.com",
    projectId: "pool-tracker25",
    storageBucket: "pool-tracker25.appspot.com",
    messagingSenderId: "704360073759",
    appId: "1:704360073759:web:2bf22300ea9b7f1a31e32a"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>
<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js"></script>


  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore(); // ✅ make this available before anything else
</script>

<script>
document.addEventListener('DOMContentLoaded', async function(){
  const tabs = {
    tabSeasons: 'sectionSeasons',
    tabPlayers: 'sectionPlayers',
    tabTeams:   'sectionTeams',
    tabMatches: 'sectionMatches',
    tabStats:   'sectionStats'
  };
  Object.keys(tabs).forEach(tabId=>{
    const btn = document.getElementById(tabId);
    const sec = document.getElementById(tabs[tabId]);
    if (!btn || !sec) {
      console.warn('Tab navigation: missing element', tabId, tabs[tabId]);
      return;
    }
    btn.addEventListener('click', ()=>{
      Object.keys(tabs).forEach(tid=>{
        const b2 = document.getElementById(tid);
        const s2 = document.getElementById(tabs[tid]);
        if(b2) b2.classList.remove('active');
        if(s2) s2.classList.remove('active');
      });
      btn.classList.add('active');
      sec.classList.add('active');
    });
  });

  let data = { seasons: [], players: [], teams: [] };

  async function loadTeamsFromDB(){
    try {
      const snapshot = await db.collection("teams").get();
      data.teams = snapshot.docs.map(doc => doc.data());
    } catch (err) {
      console.error("Error loading teams from Firestore:", err);
    }
  }

  function refreshDropdowns(){
    const selectPlayerSeason = document.getElementById('playerSeason');
    const selectTeamSeason   = document.getElementById('teamSeason');
    const editPSeasonEl      = document.getElementById('editPlayerSeason');
    const editTSeasonEl      = document.getElementById('editTeamSeason');
    selectPlayerSeason.innerHTML = '';
    if (editPSeasonEl) editPSeasonEl.innerHTML = '';
    selectTeamSeason.innerHTML = '';
    if (editTSeasonEl) editTSeasonEl.innerHTML = '';

    if(data.seasons.length === 0){
      const opt = document.createElement('option');
      opt.value = '';
      opt.textContent = 'No seasons available';
      selectPlayerSeason.appendChild(opt);
      if(editPSeasonEl) editPSeasonEl.appendChild(opt.cloneNode(true));
      selectTeamSeason.appendChild(opt.cloneNode(true));
      if(editTSeasonEl) editTSeasonEl.appendChild(opt.cloneNode(true));
      return;
    }
    data.seasons.forEach(s=>{
      const opt1 = document.createElement('option');
      opt1.value   = s.name;
      opt1.textContent = s.name;
      selectPlayerSeason.appendChild(opt1);
      if(editPSeasonEl) editPSeasonEl.appendChild(opt1.cloneNode(true));
      const opt2 = opt1.cloneNode(true);
      selectTeamSeason.appendChild(opt2);
      if(editTSeasonEl) editTSeasonEl.appendChild(opt2.cloneNode(true));
    });
  }

  function refreshSeasonsTable(){
    const tableSeasonsBodyEl = document.getElementById('tableSeasons').querySelector('tbody');
    tableSeasonsBodyEl.innerHTML = '';
    data.seasons.forEach((s, idx)=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${s.name}</td><td>${s.frames}</td><td>
        <button class="btn btn-edit" data-index="${idx}" data-action="edit">Edit</button>
        <button class="btn btn-danger" data-index="${idx}">Delete</button>
      </td>`;
      tableSeasonsBodyEl.appendChild(tr);
    });
    tableSeasonsBodyEl.querySelectorAll('button').forEach(btn=>{
      const idx = parseInt(btn.getAttribute('data-index'),10);
      if(btn.getAttribute('data-action') === 'edit'){
        btn.addEventListener('click', ()=>{
          const s = data.seasons[idx];
          const newName   = prompt("Edit season name", s.name);
          const newFrames = prompt("Edit frames per match", s.frames);
          if(newName && newFrames){
            s.name   = newName;
            s.frames = parseInt(newFrames,10) || s.frames;
            refreshSeasonsTable();
            refreshDropdowns();
          }
        });
      } else {
        btn.addEventListener('click', ()=>{
          data.seasons.splice(idx,1);
          refreshSeasonsTable();
          refreshDropdowns();
        });
      }
    });
  }

  function makeSeasonString(year, type, division){
    return `${type} ${year} ${division}`;
  }

  async function preloadData(){
    const legacySeason = makeSeasonString(2025, 'SUMMER', 'Monday BB Premier 1');
    const defaultFrames = 15;
    if(!data.seasons.some(s => s.name === legacySeason)){
      data.seasons.push({ name: legacySeason, frames: defaultFrames });
    }
    const playersToAdd = [
      { name:"Katt Singh",     team:"SPOT ON SHERIFF",   standard:"B+",  season:"SUMMER 2025 Monday BB Premier 1" },
      /* … rest of player list … */
    ];
    playersToAdd.forEach(p=>{
      if(!data.players.some(x => x.name===p.name && x.team===p.team && x.standard===p.standard && x.season===p.season)){
        data.players.push(p);
      }
    });
  }

  const formSeasonEl       = document.getElementById('formSeason');
  const formPlayerEl       = document.getElementById('formPlayer');
  const tablePlayersBody   = document.getElementById('tablePlayers').querySelector('tbody');
  const formTeamEl         = document.getElementById('formTeam');
  const selectPlayerSeason = document.getElementById('playerSeason');
  const selectPlayerTeam   = document.getElementById('playerTeam');

  function refreshPlayersTable(){
    tablePlayersBody.innerHTML = '';
    data.players.forEach((p, idx)=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${p.name}</td><td>${p.team}</td><td>${p.standard}</td><td>${p.season}</td><td>
        <button class="btn btn-edit" data-index="${idx}">Edit</button>
        <button class="btn btn-danger" data-index="${idx}" data-delete="true">Delete</button>
      </td>`;
      tablePlayersBody.appendChild(tr);
    });
    tablePlayersBody.querySelectorAll('button').forEach(btn=>{
      const idx = parseInt(btn.getAttribute('data-index'),10);
      if(btn.getAttribute('data-delete')){
        btn.addEventListener('click', ()=>{
          data.players.splice(idx,1);
          refreshPlayersTable();
        });
      } else {
        btn.addEventListener('click', ()=> openPlayerEdit(idx));
      }
    });
  }

  selectPlayerSeason.addEventListener('change', ()=>{
    selectPlayerTeam.innerHTML = '';
    const defaultOpt = document.createElement('option');
    defaultOpt.value = '';
    defaultOpt.textContent = selectPlayerSeason.value ? 'Select Team' : 'Select Season First';
    selectPlayerTeam.appendChild(defaultOpt);

    if(selectPlayerSeason.value){
      const filteredTeams = data.teams.filter(t => t.season === selectPlayerSeason.value);
      if(filteredTeams.length === 0){
        const opt = document.createElement('option');
        opt.value = '';
        opt.textContent = 'No teams for this season';
        selectPlayerTeam.appendChild(opt);
      } else {
        filteredTeams.forEach(team=>{
          const opt = document.createElement('option');
          opt.value = team.name;
          opt.textContent = team.name;
          selectPlayerTeam.appendChild(opt);
        });
      }
    }
  });

  formPlayerEl.addEventListener('submit', e=>{
    e.preventDefault();
    const player = {
      name    : document.getElementById('playerName').value.trim(),
      team    : selectPlayerTeam.value,
      standard: document.getElementById('playerStandard').value,
      season  : selectPlayerSeason.value
    };
    if(!player.name || !player.team || !player.standard || !player.season){
      alert("All fields are required.");
      return;
    }
    data.players.push(player);
    refreshPlayersTable();
    formPlayerEl.reset();
    selectPlayerTeam.innerHTML = '<option value="">Select Season First</option>';
  });

  formSeasonEl.addEventListener('submit', e=>{
    e.preventDefault();
    const year     = document.getElementById('seasonYear').value.trim();
    const type     = document.getElementById('seasonType').value;
    const division = document.getElementById('seasonDivision').value;
    const frames   = parseInt(document.getElementById('seasonFrames').value,10);
    if(!year || !type || !division || !frames){
      alert("All fields are required.");
      return;
    }
    const seasonName = makeSeasonString(year, type, division);
    data.seasons.push({ name:seasonName, frames:frames });
    refreshSeasonsTable();
    refreshDropdowns();
    formSeasonEl.reset();
  });

  formTeamEl.addEventListener('submit', async e=>{
    e.preventDefault();
    const teamSeason = document.getElementById('teamSeason').value;
    const teamName   = document.getElementById('teamName').value.trim();
    const teamDiv    = document.getElementById('teamDivision').value;
    const teamVenue  = document.getElementById('teamVenue').value.trim();
    if(!teamSeason || !teamName || !teamDiv || !teamVenue){
      alert("All fields are required.");
      return;
    }
    try {
      await db.collection("teams").add({
        season:  teamSeason,
        name:    teamName,
        division:teamDiv,
        venue:   teamVenue
      });
      data.teams.push({ season:teamSeason, name:teamName, division:teamDiv, venue:teamVenue });
      refreshTeamsTable();
      formTeamEl.reset();
    } catch(err) {
      console.error("Error adding team to Firestore:", err);
    }
  });

  function refreshTeamsTable(){
    const tableTeamsBody = document.getElementById('tableTeams').querySelector('tbody');
    tableTeamsBody.innerHTML = '';
    data.teams.forEach((t, idx)=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${t.season}</td><td>${t.name}</td><td>${t.division}</td><td>${t.venue}</td><td>
        <button class="btn btn-edit" data-index="${idx}">Edit</button>
        <button class="btn btn-danger" data-index="${idx}" data-delete="true">Delete</button>
      </td>`;
      tableTeamsBody.appendChild(tr);
    });
    tableTeamsBody.querySelectorAll('button').forEach(btn=>{
      const idx = parseInt(btn.getAttribute('data-index'),10);
      if(btn.getAttribute('data-delete')){
        btn.addEventListener('click', ()=>{
          data.teams.splice(idx,1);
          refreshTeamsTable();
        });
      } else {
        btn.addEventListener('click', ()=> openTeamEdit(idx));
      }
    });
  }

  await loadTeamsFromDB();
  await preloadData();
  refreshSeasonsTable();
  refreshDropdowns();
  refreshPlayersTable();
  refreshTeamsTable();

});
</script>

</body>
</html>
