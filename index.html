<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pool League Tracker â€” Spot On Sheriff</title>
  <style>
    body { fontâ€‘family: Arial, sansâ€‘serif; margin:0; padding:0; }
    header { background:#333; color:white; padding:10px; }
    nav { display:flex; background:#444; }
    nav button { flex:1; padding:10px; border:none; background:#444; color:white; cursor:pointer; }
    nav button.active { background:#666; }
    section { display:none; padding:20px; }
    section.active { display:block; }
    input[type=text], input[type=number], select { padding:5px; margin:5px 0; width:200px; }
    .btn { padding:6px 12px; margin:5px; cursor:pointer; }
    .btnâ€‘primary { background:#28a745; color:white; border:none; }
    .btnâ€‘danger { background:#dc3545; color:white; border:none; }
    .btnâ€‘edit { background:#007bff; color:white; border:none; }
    table { width:100%; borderâ€‘collapse:collapse; marginâ€‘top:10px; }
    table, th, td { border:1px solid #888; }
    th, td { padding:8px; textâ€‘align:left; }
    .modal { display:none; position:fixed; zâ€‘index:999; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.5); alignâ€‘items:center; justifyâ€‘content:center; }
    .modalâ€‘content { background:white; padding:20px; borderâ€‘radius:4px; width:320px; }
  </style>
</head>
<body>

<header><h1>Pool League Tracker â€” Spot On Sheriff</h1></header>

<nav>
  <button id="tabSeasons" class="active">Seasons</button>
  <button id="tabPlayers">Players</button>
  <button id="tabTeams">Teams</button>
  <button id="tabMatches">Record Match</button>
  <button id="tabStats">Stats</button>
</nav>

<section id="sectionSeasons" class="active">
  <h2>Seasons</h2>
  <form id="formSeason">
    <label>Year:<br/><input type="number" id="seasonYear" min="2000" required /></label><br/>
    <label>Type:<br/>
      <select id="seasonType" required>
        <option value="">Select</option>
        <option value="SUMMER">SUMMER</option>
        <option value="WINTER">WINTER</option>
      </select>
    </label><br/>
    <label>Division:<br/>
      <select id="seasonDivision" required>
        <option value="">Select Division</option>
        <option value="Monday BB Premier 1">Monday BB Premierâ€¯1</option>
        <option value="Monday BB Premier 2">Monday BB Premierâ€¯2</option>
        <option value="Monday BB Premier 3">Monday BB Premierâ€¯3</option>
        <option value="Monday EPA League 1">Monday EPA Leagueâ€¯1</option>
        <option value="Monday EPA League 2">Monday EPA Leagueâ€¯2</option>
        <option value="Monday EPA League 3">Monday EPA Leagueâ€¯3</option>
        <option value="Monday EPA League 4">Monday EPA Leagueâ€¯4</option>
      </select>
    </label><br/>
    <label>Frames per Match:<br/><input type="number" id="seasonFrames" min="1" required /></label><br/>
    <button class="btn btnâ€‘primary" type="submit">Add Season</button>
  </form>
  <h3>Existing Seasons</h3>
  <table id="tableSeasons">
    <thead><tr><th>Season</th><th>Frames</th><th>Actions</th></tr></thead>
    <tbody></tbody>
  </table>
</section>

<section id="sectionPlayers">
  <h2>Players</h2>
  <form id="formPlayer">
  <label>Season:<br/>
    <select id="playerSeason" required>
      <option value="">Select Season</option>
    </select>
  </label><br/>
  <label>Team:<br/>
    <select id="playerTeam" required>
      <option value="">Select Season First</option>
    </select>
  </label><br/>
  <label>Full Name:<br/>
    <input type="text" id="playerName" required />
  </label><br/>
  <label>Standard:<br/>
    <select id="playerStandard" required>
      <option value="">Select</option>
      <option value="A+">A+</option>
      <option value="A">A</option>
      <option value="A-">A-</option>
      <option value="B+">B+</option>
      <option value="B">B</option>
      <option value="B-">B-</option>
      <option value="C+">C+</option>
      <option value="C">C</option>
      <option value="C-">C-</option>
    </select>
  </label><br/>
  <button class="btn btn-primary" type="submit">Add Player</button>
</form>


  <h3>All Players</h3>
  <table id="tablePlayers">
    <thead><tr><th>Name</th><th>Team</th><th>Standard</th><th>Season</th><th>Actions</th></tr></thead>
    <tbody></tbody>
  </table>
</section>

<section id="sectionTeams">
  <h2>Teams</h2>
  <form id="formTeam">
    <label>Season:<br/><select id="teamSeason" required></select></label><br/>
    <label>Team Name:<br/><input type="text" id="teamName" required /></label><br/>
    <label>Division:<br/>
      <select id="teamDivision" required>
        <option value="">Select Division</option>
        <option value="Monday BB Premier 1">Monday BB Premierâ€¯1</option>
        <option value="Monday BB Premier 2">Monday BB Premierâ€¯2</option>
        <option value="Monday BB Premier 3">Monday BB Premierâ€¯3</option>
        <option value="Monday EPA League 1">Monday EPA Leagueâ€¯1</option>
        <option value="Monday EPA League 2">Monday EPA Leagueâ€¯2</option>
        <option value="Monday EPA League 3">Monday EPA Leagueâ€¯3</option>
        <option value="Monday EPA League 4">Monday EPA Leagueâ€¯4</option>
      </select>
    </label><br/>
    <label>Venue Address:<br/><input type="text" id="teamVenue" required /></label><br/>
    <button class="btn btnâ€‘primary" type="submit">Add Team</button>
  </form>

  <h3>All Teams</h3>
  <table id="tableTeams">
    <thead><tr><th>Season</th><th>Name</th><th>Division</th><th>Venue</th><th>Actions</th></tr></thead>
    <tbody></tbody>
  </table>
</section>

<div id="editPlayerModal" class="modal">
  <div class="modalâ€‘content">
    <h3>Edit Player (Adds new entry)</h3>
    <label>Team:<br/><input type="text" id="editPlayerTeam" required /></label><br/>
    <label>Standard:<br/>
      <select id="editPlayerStandard" required>
        <option value="">Select</option>
        <option value="A+">A+</option>
        <option value="A">A</option>
        <option value="Aâ€‘">Aâ€‘</option>
        <option value="B+">B+</option>
        <option value="B">B</option>
        <option value="Bâ€‘">Bâ€‘</option>
        <option value="C+">C+</option>
        <option value="C">C</option>
        <option value="Câ€‘">Câ€‘</option>
      </select>
    </label><br/>
    <label>Season:<br/><select id="editPlayerSeason" required></select></label><br/>
    <button id="btnSavePlayerEdit" class="btn btnâ€‘primary">Save</button>
    <button id="btnCancelPlayerEdit" class="btn btnâ€‘danger">Cancel</button>
  </div>
</div>

<div id="editTeamModal" class="modal">
  <div class="modalâ€‘content">
    <h3>Edit Team (Adds new entry)</h3>
    <label>Team Name:<br/><input type="text" id="editTeamName" required /></label><br/>
    <label>Division:<br/>
      <select id="editTeamDivision" required>
        <option value="">Select Division</option>
        <option value="Monday BB Premier 1">Monday BB Premierâ€¯1</option>
        <option value="Monday BB Premier 2">Monday BB Premierâ€¯2</option>
        <option value="Monday BB Premier 3">Monday BB Premierâ€¯3</option>
        <option value="Monday EPA League 1">Monday EPA Leagueâ€¯1</option>
        <option value="Monday EPA League 2">Monday EPA Leagueâ€¯2</option>
        <option value="Monday EPA League 3">Monday EPA Leagueâ€¯3</option>
        <option value="Monday EPA League 4">Monday EPA Leagueâ€¯4</option>
      </select>
    </label><br/>
    <label>Venue Address:<br/><input type="text" id="editTeamVenue" required /></label><br/>
    <label>Season:<br/><select id="editTeamSeason" required></select></label><br/>
    <button id="btnSaveTeamEdit" class="btn btnâ€‘primary">Save</button>
    <button id="btnCancelTeamEdit" class="btn btnâ€‘danger">Cancel</button>
  </div>
</div>
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js"></script>
  <!-- Firebase App (Core SDK) -->
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js"></script>

<!-- Firebase Firestore -->
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js"></script>

<script>
  // ðŸ”¥ Your Firebase configuration (replace with your real values)
  const firebaseConfig = {
    apiKey: "AIzaSyDfFzaHPd88vVCoJgB0KW85QULVkGKX1UQ",
    authDomain: "pool-tracker25.firebaseapp.com",
    projectId: "pool-tracker25",
    storageBucket: "pool-tracker25.firebasestorage.app",
    messagingSenderId: "704360073759",
    appId: "1:704360073759:web:2bf22300ea9b7f1a31e32a"
  };

  // Initialize Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>

<script>
document.addEventListener('DOMContentLoaded', function(){
  const tabs = {
    tabSeasons: 'sectionSeasons',
    tabPlayers: 'sectionPlayers',
    tabTeams:   'sectionTeams',
    tabMatches: 'sectionMatches',
    tabStats:   'sectionStats'
  };
  Object.keys(tabs).forEach(tabId=>{
    const btn = document.getElementById(tabId);
    const sec = document.getElementById(tabs[tabId]);
    if (!btn || !sec) {
      console.warn('Tab navigation: missing element', tabId, tabs[tabId]);
      return;
    }
    btn.addEventListener('click', ()=>{
      Object.keys(tabs).forEach(tid=>{
        const b2 = document.getElementById(tid);
        const s2 = document.getElementById(tabs[tid]);
        if(b2) b2.classList.remove('active');
        if(s2) s2.classList.remove('active');
      });
      btn.classList.add('active');
      sec.classList.add('active');
    });
  });

  let data = { seasons: [], players: [], teams: [] };
  const STORAGE_KEY = 'poolTrackerData';

  function saveData(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    console.log('Data saved', data);
  }

  function loadData(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if(raw){
      try {
        data = JSON.parse(raw);
      } catch(e){
        data = { seasons: [], players: [], teams: [] };
      }
    }
    if(!data.seasons) data.seasons = [];
    if(!data.players) data.players = [];
    if(!data.teams) data.teams = [];
    console.log('Data loaded', data);
  }

  function makeSeasonString(year, type, division){
    return `${type} ${year} ${division}`;
  }

  function preloadData(){
    const legacySeason = makeSeasonString(2025, 'SUMMER', 'Monday BB Premier 1');
    const defaultFrames = 15;
    if(!data.seasons.some(s => s.name === legacySeason)){
      data.seasons.push({ name: legacySeason, frames: defaultFrames });
    }
    const playersToAdd = [
  { name:"Katt Singh",     team:"SPOT ON SHERIFF",   standard:"B+",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Clyde Doyle",    team:"SPOT ON SHERIFF",   standard:"A-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Lacky Singh",    team:"SPOT ON SHERIFF",   standard:"B",   season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Michael Singh",  team:"SPOT ON SHERIFF",   standard:"B",   season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Nirm Singh",     team:"SPOT ON SHERIFF",   standard:"B-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Audie Miller",   team:"SPOT ON SHERIFF",   standard:"A-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Ilias Mou",      team:"SPOT ON SHERIFF",   standard:"B",   season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Jay Smith",      team:"SPOT ON SHERIFF",   standard:"A-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Tim Chambers",   team:"SPOT ON SHERIFF",   standard:"B-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Joeâ€¯Crespo",     team:"SPOT ON SHERIFF",   standard:"B",   season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Joeâ€¯Reynolds",   team:"SPOT ON SHERIFF",   standard:"A-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Clintâ€¯I'Anson",  team:"SPOT ON SHERIFF",   standard:"A+",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Domâ€¯Camara",     team:"SPOT ON SHERIFF",   standard:"B",   season:"SUMMER 2025 Monday BB Premier 1" },

  { name:"Steveâ€¯Jones",    team:"SPOT ON HUCKNALL",  standard:"B",   season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Martinâ€¯Harper",  team:"SPOT ON HUCKNALL",  standard:"B-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Garyâ€¯Newton",    team:"SPOT ON HUCKNALL",  standard:"B-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Grahamâ€¯Turnbull",team:"SPOT ON HUCKNALL",  standard:"B+",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Timâ€¯Hudson",     team:"SPOT ON HUCKNALL",  standard:"B",   season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Ianâ€¯Owen",       team:"SPOT ON HUCKNALL",  standard:"B",   season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Markâ€¯Snowshall", team:"SPOT ON HUCKNALL",  standard:"B",   season:"SUMMER 2025 Monday BB Premier 1" },

  { name:"Daleâ€¯Mellor",    team:"THE LIMEKILN",     standard:"B+",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Arronâ€¯Priest",   team:"THE LIMEKILN",     standard:"A-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Leeâ€¯Pickard",    team:"THE LIMEKILN",     standard:"B+",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Leeâ€¯Howitt",     team:"THE LIMEKILN",     standard:"A-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Paulâ€¯Riley",     team:"THE LIMEKILN",     standard:"A-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Davidâ€¯Casey",    team:"THE LIMEKILN",     standard:"A-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Jordanâ€¯Geldard", team:"THE LIMEKILN",     standard:"B+",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Samâ€¯Burton",     team:"THE LIMEKILN",     standard:"B+",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Shaneâ€¯Wood",     team:"THE LIMEKILN",     standard:"B",   season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Darrenâ€¯Golding", team:"THE LIMEKILN",     standard:"B",   season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Patâ€¯Kelley",     team:"THE LIMEKILN",     standard:"B",   season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Neilâ€¯Kelly",     team:"THE LIMEKILN",     standard:"B",   season:"SUMMER 2025 Monday BB Premier 1" },

  { name:"Richardâ€¯Deakin", team:"BESTWOOD ROAD",     standard:"B+",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Allenâ€¯Shaw",     team:"BESTWOOD ROAD",     standard:"B",   season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Dillonâ€¯Robinson",team:"BESTWOOD ROAD",     standard:"B-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Garyâ€¯Stout",     team:"BESTWOOD ROAD",     standard:"B-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Garyâ€¯Harvey",    team:"BESTWOOD ROAD",     standard:"B-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Steveâ€¯Clark",    team:"BESTWOOD ROAD",     standard:"B-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Raymondâ€¯Oldham", team:"BESTWOOD ROAD",     standard:"B-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Edâ€¯Clark",       team:"BESTWOOD ROAD",     standard:"B-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Aidenâ€¯Hewes",    team:"BESTWOOD ROAD",     standard:"B-",  season:"SUMMER 2025 Monday BB Premier 1" },

  { name:"Ryanâ€¯Norris",     team:"VICTORY STORMS",   standard:"B+",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Dannyâ€¯Butler",    team:"VICTORY STORMS",   standard:"B+",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Davidâ€¯Oxtoby",    team:"VICTORY STORMS",   standard:"B+",  season:"SUMMER 5  Monday BB Premier 1" },
  { name:"Andyâ€¯Wilson",     team:"VICTORY STORMS",   standard:"A-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Mattâ€¯Fell",       team:"VICTORY STORMS",   standard:"B",   season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Timâ€¯Hurst",       team:"VICTORY STORMS",   standard:"B+",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Tomâ€¯Laycock",     team:"VICTORY STORMS",   standard:"B+",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Coreyâ€¯Blackshaw", team:"VICTORY STORMS",   standard:"B+",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Martinâ€¯Elks",     team:"VICTORY STORMS",   standard:"B+",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Tylerâ€¯Butler",    team:"VICTORY STORMS",   standard:"B",   season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Jimmyâ€¯Hallam",    team:"VICTORY STORMS",   standard:"B",   season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Gregâ€¯Davis",      team:"VICTORY STORMS",   standard:"A",   season:"SUMMER 2025 Monday BB Premier 1" },

  { name:"Michaelâ€¯Baguley", team:"WILLOW TREE",      standard:"B-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Joeâ€¯Cammack",     team:"WILLOW TREE",      standard:"B+",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Charnceâ€¯Froome",  team:"WILLOW TREE",      standard:"B",   season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Leeâ€¯Rust",        team:"WILLOW TREE",      standard:"B",   season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Williamâ€¯Morgan",  team:"WILLOW TREE",      standard:"B-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Benâ€¯Kosneisky",   team:"WILLOW TREE",      standard:"B-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Jasonâ€¯Ward",      team:"WILLOW TREE",      standard:"B",   season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Lozâ€¯Sanderson",   team:"WILLOW TREE",      standard:"B",   season:"SUMMER 2025 Monday BB Premier 1" },

  { name:"Rashâ€¯Jamal",     team:"RILEYS A",         standard:"B-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Tomâ€¯Nicholson",  team:"RILEYS A",         standard:"B-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Jamesâ€¯Penn",     team:"RILEYS A",         standard:"B-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Patâ€¯Dolan",       team:"RILEYS A",        standard:"B",   season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Markâ€¯Abbott",     team:"RILEYS A",        standard:"B-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Martinâ€¯Wilson",   team:"RILEYS A",        standard:"B",   season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Niallâ€¯Gordon",    team:"RILEYS A",        standard:"B-",  season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Danâ€¯Bush",        team:"RILEYS A",        standard:"B",   season:"SUMMER 2025 Monday BB Premier 1" },
  { name:"Daleâ€¯Soar",       team:"RILEYS A",        standard:"B-",  season:"SUMMER 2025 Monday BB Premier 1" }
];

    playersToAdd.forEach(p=>{
      if (!data.players.some(x => x.name===p.name && x.team===p.team && x.standard===p.standard && x.season===p.season)) {
        data.players.push(p);
      }
    });
  }

  const formSeasonEl        = document.getElementById('formSeason');
  const tableSeasonsBodyEl  = document.getElementById('tableSeasons').querySelector('tbody');
  const formPlayerEl        = document.getElementById('formPlayer');
  const selectPlayerSeason  = document.getElementById('playerSeason');
  const selectPlayerTeam    = document.getElementById('playerTeam');

// When season changes, populate team list dynamically
selectPlayerSeason.addEventListener('change', () => {
  const selSeason = selectPlayerSeason.value;
  selectPlayerTeam.innerHTML = '';
  const defaultOption = document.createElement('option');
  defaultOption.value = '';
  defaultOption.textContent = selSeason ? 'Select Team' : 'Select Season First';
  selectPlayerTeam.appendChild(defaultOption);

  if (selSeason) {
    const filteredTeams = data.teams.filter(t => t.season === selSeason);
    if (filteredTeams.length === 0) {
      const opt = document.createElement('option');
      opt.value = '';
      opt.textContent = 'No teams for this season';
      selectPlayerTeam.appendChild(opt);
    } else {
      filteredTeams.forEach(team => {
        const opt = document.createElement('option');
        opt.value = team.name;
        opt.textContent = team.name;
        selectPlayerTeam.appendChild(opt);
      });
    }
  }
});
  const tablePlayersBody    = document.getElementById('tablePlayers').querySelector('tbody');
  const formTeamEl          = document.getElementById('formTeam');
  const selectTeamSeason    = document.getElementById('teamSeason');
  const tableTeamsBody      = document.getElementById('tableTeams').querySelector('tbody');

  let editPlayerIndex = null;
  let editTeamIndex   = null;

  const modalPlayerEditEl = document.getElementById('editPlayerModal');
  const modalTeamEditEl   = document.getElementById('editTeamModal');

  function refreshDropdowns(){
    selectPlayerSeason.innerHTML = '';
    const editPSeasonEl = document.getElementById('editPlayerSeason');
    if(editPSeasonEl) editPSeasonEl.innerHTML = '';
    selectTeamSeason.innerHTML = '';
    const editTSeasonEl = document.getElementById('editTeamSeason');
    if(editTSeasonEl) editTSeasonEl.innerHTML = '';

    if(data.seasons.length === 0){
      const opt  = document.createElement('option');
      opt.value  = '';
      opt.textContent = 'No seasons available';
      selectPlayerSeason.appendChild(opt);
      if(editPSeasonEl) editPSeasonEl.appendChild(opt.cloneNode(true));
      selectTeamSeason.appendChild(opt.cloneNode(true));
      if(editTSeasonEl) editTSeasonEl.appendChild(opt.cloneNode(true));
      return;
    }

    data.seasons.forEach(s=>{
      const opt1 = document.createElement('option');
      opt1.value   = s.name;
      opt1.textContent = s.name;
      selectPlayerSeason.appendChild(opt1);
      if(editPSeasonEl) editPSeasonEl.appendChild(opt1.cloneNode(true));
      const opt2 = opt1.cloneNode(true);
      selectTeamSeason.appendChild(opt2);
      if(editTSeasonEl) editTSeasonEl.appendChild(opt2.cloneNode(true));
    });
  }

  function refreshSeasonsTable(){
    tableSeasonsBodyEl.innerHTML = '';
    data.seasons.forEach((s, idx)=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${s.name}</td><td>${s.frames}</td><td>
        <button class="btn btnâ€‘edit" data-index="${idx}" data-action="edit">Edit</button>
        <button class="btn btnâ€‘danger" data-index="${idx}">Delete</button>
      </td>`;
      tableSeasonsBodyEl.appendChild(tr);
    });
    tableSeasonsBodyEl.querySelectorAll('button').forEach(btn=>{
      const idx = parseInt(btn.getAttribute('data-index'),10);
      if(btn.getAttribute('data-action') === 'edit'){
        btn.addEventListener('click', ()=>{
          const s = data.seasons[idx];
          const newName   = prompt("Edit season name", s.name);
          const newFrames = prompt("Edit frames per match", s.frames);
          if(newName && newFrames){
            s.name   = newName;
            s.frames = parseInt(newFrames,10) || s.frames;
            saveData();
            refreshSeasonsTable();
            refreshDropdowns();
          }
        });
      } else {
        btn.addEventListener('click', ()=>{
          data.seasons.splice(idx,1);
          saveData();
          refreshSeasonsTable();
          refreshDropdowns();
        });
      }
    });
  }

  formSeasonEl.addEventListener('submit', e=>{
    e.preventDefault();
    const year     = document.getElementById('seasonYear').value.trim();
    const type     = document.getElementById('seasonType').value;
    const division = document.getElementById('seasonDivision').value;
    const frames   = parseInt(document.getElementById('seasonFrames').value,10);
    if(!year || !type || !division || !frames){
      alert("All fields are required.");
      return;
    }
    const seasonName = makeSeasonString(year, type, division);
    data.seasons.push({ name: seasonName, frames: frames });
    saveData();
    refreshSeasonsTable();
    refreshDropdowns();
    formSeasonEl.reset();
  });

  function refreshPlayersTable(){
    tablePlayersBody.innerHTML = '';
    data.players.forEach((p, idx)=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${p.name}</td><td>${p.team}</td><td>${p.standard}</td><td>${p.season}</td><td>
        <button class="btn btnâ€‘edit" data-index="${idx}">Edit</button>
        <button class="btn btnâ€‘danger" data-index="${idx}" data-delete="true">Delete</button>
      </td>`;
      tablePlayersBody.appendChild(tr);
    });
    tablePlayersBody.querySelectorAll('button').forEach(btn=>{
      const idx = parseInt(btn.getAttribute('data-index'),10);
      if(btn.getAttribute('data-delete')){
        btn.addEventListener('click', ()=>{
          data.players.splice(idx,1);
          saveData();
          refreshPlayersTable();
        });
      } else {
        btn.addEventListener('click', ()=> openPlayerEdit(idx));
      }
    });
  }

  formPlayerEl.addEventListener('submit', e=>{
    e.preventDefault();
    const player = {
      name    : document.getElementById('playerName').value.trim(),
      team    : selectPlayerTeam.value,
      standard: document.getElementById('playerStandard').value,
      season  : document.getElementById('playerSeason').value
    };
    if(!player.name || !player.team || !player.standard || !player.season){
      alert("All fields are required.");
      return;
    }
    data.players.push(player);
    saveData();
    refreshPlayersTable();
    formPlayerEl.reset();
    selectPlayerTeam.innerHTML = '<option value="">Select Season First</option>';
  });

  function openPlayerEdit(idx){
    editPlayerIndex = idx;
    const p = data.players[idx];
    document.getElementById('editPlayerTeam').value     = p.team;
    document.getElementById('editPlayerStandard').value = p.standard;
    document.getElementById('editPlayerSeason').value   = p.season;
    modalPlayerEditEl.style.display = 'flex';
  }

  document.getElementById('btnCancelPlayerEdit').addEventListener('click', ()=>{
    modalPlayerEditEl.style.display = 'none';
    editPlayerIndex = null;
  });

  document.getElementById('btnSavePlayerEdit').addEventListener('click', ()=>{
    const newTeam     = document.getElementById('editPlayerTeam').value.trim();
    const newStandard = document.getElementById('editPlayerStandard').value;
    const newSeason   = document.getElementById('editPlayerSeason').value;
    if(!newTeam || !newStandard || !newSeason){
      alert("All fields are required.");
      return;
    }
    const original = data.players[editPlayerIndex];
    const newEntry = { name: original.name, team: newTeam, standard: newStandard, season: newSeason };
    data.players.push(newEntry);
    saveData();
    refreshPlayersTable();
    modalPlayerEditEl.style.display = 'none';
    editPlayerIndex = null;
  });

  function refreshTeamsTable(){
    tableTeamsBody.innerHTML = '';
    data.teams.forEach((t, idx)=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${t.season}</td><td>${t.name}</td><td>${t.division}</td><td>${t.venue}</td><td>
        <button class="btn btnâ€‘edit" data-index="${idx}">Edit</button>
        <button class="btn btnâ€‘danger" data-index="${idx}" data-delete="true">Delete</button>
      </td>`;
      tableTeamsBody.appendChild(tr);
    });
    tableTeamsBody.querySelectorAll('button').forEach(btn=>{
      const idx = parseInt(btn.getAttribute('data-index'),10);
      if(btn.getAttribute('data-delete')){
        btn.addEventListener('click', ()=>{
          data.teams.splice(idx,1);
          saveData();
          refreshTeamsTable();
        });
      } else {
        btn.addEventListener('click', ()=> openTeamEdit(idx));
      }
    });
  }

  formTeamEl.addEventListener('submit', e=>{
    e.preventDefault();
    console.log('Add Team submit captured');
    const teamSeason = document.getElementById('teamSeason').value;
    const teamName   = document.getElementById('teamName').value.trim();
    const teamDiv    = document.getElementById('teamDivision').value;
    const teamVenue  = document.getElementById('teamVenue').value.trim();
    if(!teamSeason || !teamName || !teamDiv || !teamVenue){
      alert("All fields are required.");
      return;
    }
    await db.collection("teams").add({
  season: teamSeason,
  name: teamName,
  division: teamDiv,
  venue: teamVenue
});
refreshTeamsTable();

    formTeamEl.reset();
  });

  function openTeamEdit(idx){
    editTeamIndex = idx;
    const t = data.teams[idx];
    document.getElementById('editTeamName').value     = t.name;
    document.getElementById('editTeamDivision').value = t.division;
    document.getElementById('editTeamVenue').value    = t.venue;
    document.getElementById('editTeamSeason').value   = t.season;
    modalTeamEditEl.style.display = 'flex';
  }

  document.getElementById('btnCancelTeamEdit').addEventListener('click', ()=>{
    modalTeamEditEl.style.display = 'none';
    editTeamIndex = null;
  });

  document.getElementById('btnSaveTeamEdit').addEventListener('click', ()=>{
    const newName     = document.getElementById('editTeamName').value.trim();
    const newDivision = document.getElementById('editTeamDivision').value;
    const newVenue    = document.getElementById('editTeamVenue').value.trim();
    const newSeason   = document.getElementById('editTeamSeason').value;
    if(!newName || !newDivision || !newVenue || !newSeason){
      alert("All fields are required.");
      return;
    }
    const newEntry = { season: newSeason, name: newName, division: newDivision, venue: newVenue };
    data.teams.push(newEntry);
    saveData();
    refreshTeamsTable();
    modalTeamEditEl.style.display = 'none';
    editTeamIndex = null;
  });

  // initialize
  loadData();
  preloadData();
  async function loadTeamsFromDB() {
  const snapshot = await db.collection("teams").get();
  data.teams = snapshot.docs.map(doc => doc.data());
  refreshTeamsTable();
}
await loadTeamsFromDB();

  saveData();
  refreshSeasonsTable();
  refreshDropdowns();
  refreshPlayersTable();
  refreshTeamsTable();
});
</script>

</body>
</html>
